# Frontend Tests

This directory contains browser-based tests for the CivJS game frontend using Playwright.

## Test Files

### `game-creation-flow-simple.spec.ts`
**Static Tests** - Tests the game creation flow and map rendering functionality using mock HTML pages:

- **Main Test**: Verifies that when the game loads successfully, the map displays properly without showing "No Map Data - Connect to Server" or "Loading Tileset..." placeholder messages.
- **Loading State Test**: Verifies that loading states are shown appropriately when map data is not yet available.
- **No Data State Test**: Verifies that the "No Map Data" message is shown when not connected to the server.

### `game-creation-flow-real.spec.ts` & `game-creation-flow-integration.spec.ts`
**Integration Tests with Real Game IDs** - Tests using actual UUID game IDs that would be generated by your backend:

- **Real Game Creation**: Creates games via backend API calls and gets actual UUID game IDs
- **Real URL Navigation**: Tests navigation to `/game/{actual-uuid}` URLs
- **Game ID Validation**: Tests handling of various game ID formats (valid UUIDs, invalid formats, non-existent games)
- **Concurrent Game Creation**: Tests creating and navigating to multiple games simultaneously
- **API Integration**: Includes helper classes for interacting with your game creation APIs

### `game-creation-flow-backend-data.spec.ts`
**Real Backend Data Format Tests** - Tests using exact backend Socket.IO message formats:

- **Backend Message Simulation**: Simulates exact `map-data`, `map-info`, and `tile-info-batch` packets from GameManager.ts
- **Freeciv-web Compatibility**: Uses the exact data structures your backend sends to the client
- **Real Terrain Data**: Tests with 11 different terrain types, resources, elevation, rivers
- **Exact Tile Format**: Uses backend tile format with `tile`, `x`, `y`, `terrain`, `known`, `seen`, etc.
- **Global Variables**: Properly sets up `window.map`, `window.tiles`, and rendering system like real client

### `helpers/game-api.ts`
**API Helper Utilities** - Provides functionality for:

- Creating real games via backend API
- Generating valid mock UUIDs when backend is unavailable
- Joining games as players
- Starting and managing games
- Cleanup of test data

### Key Assertions

The tests specifically verify that:
1. When game data is loaded, placeholder messages should be hidden (`display: none`)
2. Canvas should render actual content (non-transparent pixels)
3. Game UI elements (tabs, status panel, turn button) should be visible and properly labeled
4. Different loading states are handled correctly

## Running Tests

```bash
# Run all tests
npm test

# Run specific test suites
npm run test:simple        # Static HTML tests (fastest, most reliable)
npm run test:backend-data   # Backend data format tests (recommended)
npm run test:integration   # Integration tests with real game IDs
npm run test:real          # Real game creation tests
npm run test:game-flow     # All game creation flow tests

# Run tests with UI (interactive mode)
npm run test:ui

# Run tests in headed mode (see browser)
npm run test:headed

# From root directory
npm run test:client
```

## Test Architecture

These tests use static HTML pages with mock JavaScript to simulate the game environment. This approach was chosen to:

1. Avoid dependency issues with the dev server build process
2. Focus specifically on the map rendering logic and UI states
3. Provide fast, reliable test execution
4. Test the exact conditions mentioned in the requirements

The tests mock:
- Canvas 2D rendering context
- MapRenderer behavior 
- Game state data (tiles, map dimensions)
- UI component interactions

## Screenshots

Test runs generate screenshots in the `test-results/` directory for visual verification of the rendered state.

## Future Enhancements

For a full integration test suite, you would want to:
1. Fix the Tailwind CSS build configuration 
2. Add proper server mocking with realistic Socket.IO responses
3. Test actual React component rendering
4. Add performance and accessibility testing